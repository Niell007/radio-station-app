import AdminLayout from '../../../layouts/AdminLayout.astro';
import { prisma } from '../../../lib/prisma';
import { KaraokeUploader } from '../../../components/admin/KaraokeUploader';
import { KaraokeList } from '../../../components/admin/KaraokeList';

// Fetch karaoke files with pagination
const page = Number(Astro.url.searchParams.get('page')) || 1;
const limit = 10;
const skip = (page - 1) * limit;

const [karaokeFiles, total] = await Promise.all([
  prisma.karaokeFile.findMany({
    take: limit,
    skip,
    orderBy: { uploadedAt: 'desc' },
    select: {
      id: true,
      title: true,
      artist: true,
      language: true,
      genre: true,
      fileUrl: true,
      lyricsUrl: true,
      uploadedAt: true
    }
  }),
  prisma.karaokeFile.count()
]);

const totalPages = Math.ceil(total / limit);

<AdminLayout title="Karaoke Management">
  <div class="mb-8">
    <h1 class="text-2xl font-semibold text-gray-900 dark:text-white">
      Karaoke Management
    </h1>
    <p class="mt-1 text-sm text-gray-500 dark:text-gray-400">
      Upload and manage karaoke files for your radio station.
    </p>
  </div>

  <!-- Upload Section -->
  <div class="p-4 mb-8 bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 dark:bg-gray-800">
    <h2 class="mb-4 text-xl font-semibold text-gray-900 dark:text-white">
      Upload Karaoke Files
    </h2>
    <KaraokeUploader client:load />
  </div>

  <!-- List Section -->
  <div class="bg-white border border-gray-200 rounded-lg shadow-sm dark:border-gray-700 dark:bg-gray-800">
    <div class="p-4 border-b border-gray-200 dark:border-gray-700">
      <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
        Karaoke Files
      </h2>
    </div>
    <KaraokeList
      files={karaokeFiles}
      currentPage={page}
      totalPages={totalPages}
      client:load
    />
  </div>
</AdminLayout> 